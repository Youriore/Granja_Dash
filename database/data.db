-- Crear la base de datos
CREATE DATABASE IF NOT EXISTS GranjaDashboard;
USE GranjaDashboard;

-- Tabla de roles
CREATE TABLE roles (
    id_rol INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL
);

-- Tabla de usuarios
CREATE TABLE usuarios (
    id_usuario INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    usuario VARCHAR(100) NOT NULL UNIQUE,
    clave VARCHAR(255) NOT NULL,
    id_rol INT NOT NULL,
    FOREIGN KEY (id_rol) REFERENCES roles(id_rol)
);

-- Tabla de categor√≠as de animales
CREATE TABLE categoria_animales (
    id_categoria INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT
);

-- Tabla de razas
CREATE TABLE raza_animales (
    id_raza INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    id_categoria INT NOT NULL,
    FOREIGN KEY (id_categoria) REFERENCES categoria_animales(id_categoria) ON DELETE RESTRICT
);

-- Tabla de lotes
CREATE TABLE lote_animales (
    id_lote INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    cantidad INT NOT NULL,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    id_raza INT NOT NULL,
    imagen VARCHAR(255),
    FOREIGN KEY (id_raza) REFERENCES raza_animales(id_raza)
);

-- Tabla de productos animales
CREATE TABLE producto_animales (
    id_producto INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT,
    cantidad_actual INT NOT NULL DEFAULT 0,
    id_raza INT NOT NULL,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_raza) REFERENCES raza_animales(id_raza)
);

-- Stock de productos-
CREATE TABLE stock_productos (
    id_stock INT AUTO_INCREMENT PRIMARY KEY,
    id_producto INT NOT NULL,
    tipo ENUM('ENTRADA', 'SALIDA') NOT NULL,
    cantidad INT NOT NULL,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_producto) REFERENCES producto_animales(id_producto)
);

-- Tabla de alimentos
CREATE TABLE alimentos (
    id_alimento INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    descripcion TEXT,
    cantidad_actual INT NOT NULL DEFAULT 0,
    imagen VARCHAR(255),
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Stock de alimentos
CREATE TABLE stock_alimentos (
    id_stock INT AUTO_INCREMENT PRIMARY KEY,
    id_alimento INT NOT NULL,
    id_raza INT,  -- Puede ser NULL en entradas
    tipo ENUM('ENTRADA', 'SALIDA') NOT NULL,
    cantidad INT NOT NULL,
    costo DECIMAL(10, 2),  -- Solo aplica para ENTRADA
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (id_alimento) REFERENCES alimentos(id_alimento),
    FOREIGN KEY (id_raza) REFERENCES raza_animales(id_raza)
);

-- Tabla de citas
CREATE TABLE citas (
    id_cita INT AUTO_INCREMENT PRIMARY KEY,
    titulo VARCHAR(100) NOT NULL,
    descripcion TEXT,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    id_lote INT NOT NULL,
    FOREIGN KEY (id_lote) REFERENCES lote_animales(id_lote)
);

-- Tabla de historial mensual
CREATE TABLE historial_mensual (
    id_historial INT AUTO_INCREMENT PRIMARY KEY,
    mes_anio VARCHAR(20) NOT NULL,
    total_animales INT,
    total_alimentos INT,
    total_productos INT,
    resumen TEXT,
    fecha DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ---------------------------------------
-- INSERTAR DATOS DE PRUEBA
-- ---------------------------------------

-